{% extends 'base.html' %}

{% block content %}
<div style="max-width: 1000px; margin: 0 auto;">
    
    <div style="text-align: center; margin-bottom: 30px;">
        <h1 style="color: #8e44ad; margin-bottom: 10px;">üß™ Advanced Lab</h1>
        <p style="color: #7f8c8d;">–°–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –∞—Ç–∞–∫–∏: Client-Side XSS —Ç–∞ —Å–ª—ñ–ø—ñ —ñ–Ω'—î–∫—Ü—ñ—ó.</p>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
        
        <div class="box" style="border-top: 4px solid #e67e22;">
            <h3 style="color: #e67e22; margin-top:0;">1. DOM-Based XSS</h3>
            <p style="font-size:13px;">–°–∫—Ä–∏–ø—Ç –∑—á–∏—Ç—É—î –¥–∞–Ω—ñ –∑ URL (–ø—ñ—Å–ª—è #) —ñ –≤—Å—Ç–∞–≤–ª—è—î —ó—Ö —É —Å—Ç–æ—Ä—ñ–Ω–∫—É –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏.</p>
            
            <div id="welcome-msg" style="padding: 15px; background: #fdf2e9; border: 1px dashed #e67e22; border-radius: 5px; text-align: center;">
                –û—á—ñ–∫—É–≤–∞–Ω–Ω—è —Ö–µ—à—Ç–µ–≥—É...
            </div>
            
            <div style="margin-top: 15px;">
                <p style="font-size: 12px; color: #666;">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É, —â–æ–± —Å–∏–º—É–ª—é–≤–∞—Ç–∏ –∞—Ç–∞–∫—É:</p>
                <button onclick="attackDom()" class="btn btn-orange btn-full">–ê–¢–ê–ö–£–í–ê–¢–ò –ß–ï–†–ï–ó URL # üîó</button>
            </div>

            <script>
                // –í–†–ê–ó–õ–ò–í–ò–ô –ö–û–î
                // –ú–∏ —á–∏—Ç–∞—î–º–æ –≤—Å–µ, —â–æ –ø—ñ—Å–ª—è # –≤ –∞–¥—Ä–µ—Å–Ω–æ–º—É —Ä—è–¥–∫—É
                var hash = decodeURIComponent(window.location.hash.substring(1));
                
                // –Ü –≤—Å—Ç–∞–≤–ª—è—î–º–æ —Ü–µ —è–∫ HTML (innerHTML) - —Ü–µ —ñ —î DOM XSS
                if(hash) {
                    document.getElementById("welcome-msg").innerHTML = "–ü—Ä–∏–≤—ñ—Ç, " + hash;
                }

                function attackDom() {
                    // –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Å—Ç–æ—Ä—ñ–Ω–∫—É –∑ —à–∫—ñ–¥–ª–∏–≤–∏–º —Ö–µ—à–µ–º
                    window.location.hash = "#<img src=x onerror=alert('DOM_XSS_SUCCESS')>";
                    window.location.reload();
                }
            </script>
        </div>

        <div class="box" style="border-top: 4px solid #2c3e50;">
            <h3 style="color: #2c3e50; margin-top:0;">2. Blind SQL Injection</h3>
            <p style="font-size:13px;">–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –ª–∏—à–µ "–¢–∞–∫" –∞–±–æ "–ù—ñ". –ü–æ–º–∏–ª–æ–∫ –Ω–µ –≤–∏–¥–Ω–æ.</p>
            
            <form id="blind-form" class="ajax-form">
                <input type="text" name="username" placeholder="Check username (e.g. admin)" style="width: 100%; padding: 10px; margin-bottom: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px;">
                <button type="submit" class="btn btn-blue btn-full" style="background: #2c3e50;">–ü–ï–†–ï–í–Ü–†–ò–¢–ò –ù–ê–Ø–í–ù–Ü–°–¢–¨</button>
            </form>

            <div id="blind-result" style="margin-top: 15px; text-align: center; font-weight: bold; min-height: 20px;"></div>
        </div>

    </div>
</div>

<script>
    // –û–±—Ä–æ–±–∫–∞ —Ñ–æ—Ä–º–∏ Blind SQL
    document.getElementById('blind-form').onsubmit = async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const resDiv = document.getElementById('blind-result');
        
        resDiv.innerHTML = "Checking...";
        
        try {
            const response = await fetch('/api/check_username', { method: 'POST', body: formData });
            const data = await response.json();
            
            if (data.exists) {
                resDiv.innerHTML = "<span style='color:green'>‚úÖ User exists (TRUE)</span>";
            } else {
                resDiv.innerHTML = "<span style='color:red'>‚ùå User not found (FALSE)</span>";
            }
        } catch (err) {
            resDiv.innerHTML = "Error connecting to server";
        }
    };
</script>
{% endblock %}